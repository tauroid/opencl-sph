\hypertarget{particle__system__host_8c}{}\section{/home/adam/\+Documents/\+Programming/phd-\/project/opencl-\/implementation/src/opencl/particle\+\_\+system\+\_\+host.c File Reference}
\label{particle__system__host_8c}\index{/home/adam/\+Documents/\+Programming/phd-\/project/opencl-\/implementation/src/opencl/particle\+\_\+system\+\_\+host.\+c@{/home/adam/\+Documents/\+Programming/phd-\/project/opencl-\/implementation/src/opencl/particle\+\_\+system\+\_\+host.\+c}}
{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$math.\+h$>$}\\*
{\ttfamily \#include $<$C\+L/opencl.\+h$>$}\\*
{\ttfamily \#include \char`\"{}clerror.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}particle\+\_\+system\+\_\+host.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../particle\+\_\+system.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../note.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../3rdparty/whereami.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}platforminfo.\+h\char`\"{}}\\*
Include dependency graph for particle\+\_\+system\+\_\+host.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{particle__system__host_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{particle__system__host_8c_a46cb5aeb6a7cf1d2b4390d87d3eb6ab6}{N\+U\+M\+\_\+\+P\+S\+\_\+\+A\+R\+G\+S}~10
\item 
\#define \hyperlink{particle__system__host_8c_aba1cf17d90e669f17aa5c265642d871d}{W\+G\+\_\+\+F\+U\+J\+\_\+\+S\+Z}~896
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{particle__system__host_8c_a744914e82d7deaaab9366819f7570ace}{init\+\_\+ps\+\_\+opencl} ()
\item 
void \hyperlink{particle__system__host_8c_a913da98edf2caadbdc7e74a2c04a72b9}{increment\+\_\+position\+\_\+0\+\_\+device\+\_\+opencl} ()
\item 
void \hyperlink{particle__system__host_8c_a385a5fd6747f1639c09f17df6791ebd5}{decrement\+\_\+position\+\_\+0\+\_\+device\+\_\+opencl} ()
\item 
void \hyperlink{particle__system__host_8c_a2d2a85cfd370a03d94db3e13b6b1d2e0}{bin\+\_\+and\+\_\+sort\+\_\+device\+\_\+opencl} (\hyperlink{structpsdata}{psdata} $\ast$data)
\item 
void \hyperlink{particle__system__host_8c_a6a8c640dd557b7a19fe506f24f58c2ae}{find\+\_\+particle\+\_\+bins\+\_\+device\+\_\+opencl} (\hyperlink{structpsdata}{psdata} $\ast$data)
\item 
void \hyperlink{particle__system__host_8c_ae135bc768db782f0b315a07b0cf9d61a}{count\+\_\+particles\+\_\+in\+\_\+bins\+\_\+device\+\_\+opencl} (\hyperlink{structpsdata}{psdata} $\ast$data)
\item 
void \hyperlink{particle__system__host_8c_a2f9361e3844559923a7128b5c4770cc9}{populate\+\_\+position\+\_\+cuboid\+\_\+device\+\_\+opencl} (double x1, double y1, double z1, double x2, double y2, double z2, unsigned int xsize, unsigned int ysize, unsigned int zsize)
\item 
\hyperlink{structpsdata__bufList}{psdata\+\_\+buf\+List} \hyperlink{particle__system__host_8c_a2a290247d653a7f0c63f1a9ebc0c300d}{create\+\_\+psdata\+\_\+opencl} (\hyperlink{structpsdata}{psdata} data)
\item 
void \hyperlink{particle__system__host_8c_a264aaddb80e120e5ea4aee8685dc89ed}{opencl\+\_\+use\+\_\+buflist} (\hyperlink{structpsdata__bufList}{psdata\+\_\+buf\+List} bl)
\item 
void \hyperlink{particle__system__host_8c_a12619fd915a64b4a747df1a396a33449}{opencl\+\_\+set\+\_\+kernel\+\_\+buflist} (\hyperlink{structpsdata__bufList}{psdata\+\_\+buf\+List} bl, cl\+\_\+kernel kernel)
\item 
void \hyperlink{particle__system__host_8c_a7cedfb0b69b1ed8eea5ed8504385fdf8}{free\+\_\+psdata\+\_\+opencl} (\hyperlink{structpsdata__bufList}{psdata\+\_\+buf\+List} bl)
\item 
void \hyperlink{particle__system__host_8c_a017aa0e283c0bb6ee128ff69cf10dd81}{sync\+\_\+psdata\+\_\+host\+\_\+to\+\_\+device} (\hyperlink{structpsdata}{psdata} data, \hyperlink{structpsdata__bufList}{psdata\+\_\+buf\+List} bl)
\item 
void \hyperlink{particle__system__host_8c_a543f95a759ce9b341f399c0c7e52b909}{sync\+\_\+psdata\+\_\+device\+\_\+to\+\_\+host} (\hyperlink{structpsdata}{psdata} data, \hyperlink{structpsdata__bufList}{psdata\+\_\+buf\+List} bl)
\item 
void \hyperlink{particle__system__host_8c_ae70d2a7474666f266b0ea73b278989bf}{terminate\+\_\+ps\+\_\+opencl} ()
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{particle__system__host_8c_a46cb5aeb6a7cf1d2b4390d87d3eb6ab6}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!N\+U\+M\+\_\+\+P\+S\+\_\+\+A\+R\+G\+S@{N\+U\+M\+\_\+\+P\+S\+\_\+\+A\+R\+G\+S}}
\index{N\+U\+M\+\_\+\+P\+S\+\_\+\+A\+R\+G\+S@{N\+U\+M\+\_\+\+P\+S\+\_\+\+A\+R\+G\+S}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{N\+U\+M\+\_\+\+P\+S\+\_\+\+A\+R\+G\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define N\+U\+M\+\_\+\+P\+S\+\_\+\+A\+R\+G\+S~10}\label{particle__system__host_8c_a46cb5aeb6a7cf1d2b4390d87d3eb6ab6}
\hypertarget{particle__system__host_8c_aba1cf17d90e669f17aa5c265642d871d}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!W\+G\+\_\+\+F\+U\+J\+\_\+\+S\+Z@{W\+G\+\_\+\+F\+U\+J\+\_\+\+S\+Z}}
\index{W\+G\+\_\+\+F\+U\+J\+\_\+\+S\+Z@{W\+G\+\_\+\+F\+U\+J\+\_\+\+S\+Z}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{W\+G\+\_\+\+F\+U\+J\+\_\+\+S\+Z}]{\setlength{\rightskip}{0pt plus 5cm}\#define W\+G\+\_\+\+F\+U\+J\+\_\+\+S\+Z~896}\label{particle__system__host_8c_aba1cf17d90e669f17aa5c265642d871d}


\subsection{Function Documentation}
\hypertarget{particle__system__host_8c_a2d2a85cfd370a03d94db3e13b6b1d2e0}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!bin\+\_\+and\+\_\+sort\+\_\+device\+\_\+opencl@{bin\+\_\+and\+\_\+sort\+\_\+device\+\_\+opencl}}
\index{bin\+\_\+and\+\_\+sort\+\_\+device\+\_\+opencl@{bin\+\_\+and\+\_\+sort\+\_\+device\+\_\+opencl}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{bin\+\_\+and\+\_\+sort\+\_\+device\+\_\+opencl}]{\setlength{\rightskip}{0pt plus 5cm}void bin\+\_\+and\+\_\+sort\+\_\+device\+\_\+opencl (
\begin{DoxyParamCaption}
\item[{{\bf psdata} $\ast$}]{data}
\end{DoxyParamCaption}
)}\label{particle__system__host_8c_a2d2a85cfd370a03d94db3e13b6b1d2e0}
\hypertarget{particle__system__host_8c_ae135bc768db782f0b315a07b0cf9d61a}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!count\+\_\+particles\+\_\+in\+\_\+bins\+\_\+device\+\_\+opencl@{count\+\_\+particles\+\_\+in\+\_\+bins\+\_\+device\+\_\+opencl}}
\index{count\+\_\+particles\+\_\+in\+\_\+bins\+\_\+device\+\_\+opencl@{count\+\_\+particles\+\_\+in\+\_\+bins\+\_\+device\+\_\+opencl}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{count\+\_\+particles\+\_\+in\+\_\+bins\+\_\+device\+\_\+opencl}]{\setlength{\rightskip}{0pt plus 5cm}void count\+\_\+particles\+\_\+in\+\_\+bins\+\_\+device\+\_\+opencl (
\begin{DoxyParamCaption}
\item[{{\bf psdata} $\ast$}]{data}
\end{DoxyParamCaption}
)}\label{particle__system__host_8c_ae135bc768db782f0b315a07b0cf9d61a}
\hypertarget{particle__system__host_8c_a2a290247d653a7f0c63f1a9ebc0c300d}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!create\+\_\+psdata\+\_\+opencl@{create\+\_\+psdata\+\_\+opencl}}
\index{create\+\_\+psdata\+\_\+opencl@{create\+\_\+psdata\+\_\+opencl}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{create\+\_\+psdata\+\_\+opencl}]{\setlength{\rightskip}{0pt plus 5cm}{\bf psdata\+\_\+buf\+List} create\+\_\+psdata\+\_\+opencl (
\begin{DoxyParamCaption}
\item[{{\bf psdata}}]{data}
\end{DoxyParamCaption}
)}\label{particle__system__host_8c_a2a290247d653a7f0c63f1a9ebc0c300d}
Create a mirror buffer for psdata on the G\+P\+U

Copies the data from the supplied psdata struct to the G\+P\+U, omitting host\+\_\+data.


\begin{DoxyParams}{Parameters}
{\em data} & The host buffer to copy \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Buffer list referencing the newly created device side buffer 
\end{DoxyReturn}
\hypertarget{particle__system__host_8c_a385a5fd6747f1639c09f17df6791ebd5}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!decrement\+\_\+position\+\_\+0\+\_\+device\+\_\+opencl@{decrement\+\_\+position\+\_\+0\+\_\+device\+\_\+opencl}}
\index{decrement\+\_\+position\+\_\+0\+\_\+device\+\_\+opencl@{decrement\+\_\+position\+\_\+0\+\_\+device\+\_\+opencl}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{decrement\+\_\+position\+\_\+0\+\_\+device\+\_\+opencl}]{\setlength{\rightskip}{0pt plus 5cm}void decrement\+\_\+position\+\_\+0\+\_\+device\+\_\+opencl (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{particle__system__host_8c_a385a5fd6747f1639c09f17df6791ebd5}
\hypertarget{particle__system__host_8c_a6a8c640dd557b7a19fe506f24f58c2ae}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!find\+\_\+particle\+\_\+bins\+\_\+device\+\_\+opencl@{find\+\_\+particle\+\_\+bins\+\_\+device\+\_\+opencl}}
\index{find\+\_\+particle\+\_\+bins\+\_\+device\+\_\+opencl@{find\+\_\+particle\+\_\+bins\+\_\+device\+\_\+opencl}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{find\+\_\+particle\+\_\+bins\+\_\+device\+\_\+opencl}]{\setlength{\rightskip}{0pt plus 5cm}void find\+\_\+particle\+\_\+bins\+\_\+device\+\_\+opencl (
\begin{DoxyParamCaption}
\item[{{\bf psdata} $\ast$}]{data}
\end{DoxyParamCaption}
)}\label{particle__system__host_8c_a6a8c640dd557b7a19fe506f24f58c2ae}
\hypertarget{particle__system__host_8c_a7cedfb0b69b1ed8eea5ed8504385fdf8}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!free\+\_\+psdata\+\_\+opencl@{free\+\_\+psdata\+\_\+opencl}}
\index{free\+\_\+psdata\+\_\+opencl@{free\+\_\+psdata\+\_\+opencl}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{free\+\_\+psdata\+\_\+opencl}]{\setlength{\rightskip}{0pt plus 5cm}void free\+\_\+psdata\+\_\+opencl (
\begin{DoxyParamCaption}
\item[{{\bf psdata\+\_\+buf\+List}}]{bl}
\end{DoxyParamCaption}
)}\label{particle__system__host_8c_a7cedfb0b69b1ed8eea5ed8504385fdf8}
Release referenced buffer \hypertarget{particle__system__host_8c_a913da98edf2caadbdc7e74a2c04a72b9}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!increment\+\_\+position\+\_\+0\+\_\+device\+\_\+opencl@{increment\+\_\+position\+\_\+0\+\_\+device\+\_\+opencl}}
\index{increment\+\_\+position\+\_\+0\+\_\+device\+\_\+opencl@{increment\+\_\+position\+\_\+0\+\_\+device\+\_\+opencl}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{increment\+\_\+position\+\_\+0\+\_\+device\+\_\+opencl}]{\setlength{\rightskip}{0pt plus 5cm}void increment\+\_\+position\+\_\+0\+\_\+device\+\_\+opencl (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{particle__system__host_8c_a913da98edf2caadbdc7e74a2c04a72b9}
\hypertarget{particle__system__host_8c_a744914e82d7deaaab9366819f7570ace}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!init\+\_\+ps\+\_\+opencl@{init\+\_\+ps\+\_\+opencl}}
\index{init\+\_\+ps\+\_\+opencl@{init\+\_\+ps\+\_\+opencl}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{init\+\_\+ps\+\_\+opencl}]{\setlength{\rightskip}{0pt plus 5cm}void init\+\_\+ps\+\_\+opencl (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{particle__system__host_8c_a744914e82d7deaaab9366819f7570ace}
Initialise Open\+C\+L

Detects hardware, creates command queues, compiles particle\+\_\+system\+\_\+kern.\+cl and creates kernels \hypertarget{particle__system__host_8c_a12619fd915a64b4a747df1a396a33449}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!opencl\+\_\+set\+\_\+kernel\+\_\+buflist@{opencl\+\_\+set\+\_\+kernel\+\_\+buflist}}
\index{opencl\+\_\+set\+\_\+kernel\+\_\+buflist@{opencl\+\_\+set\+\_\+kernel\+\_\+buflist}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{opencl\+\_\+set\+\_\+kernel\+\_\+buflist}]{\setlength{\rightskip}{0pt plus 5cm}void opencl\+\_\+set\+\_\+kernel\+\_\+buflist (
\begin{DoxyParamCaption}
\item[{{\bf psdata\+\_\+buf\+List}}]{bl, }
\item[{cl\+\_\+kernel}]{kernel}
\end{DoxyParamCaption}
)}\label{particle__system__host_8c_a12619fd915a64b4a747df1a396a33449}
\hypertarget{particle__system__host_8c_a264aaddb80e120e5ea4aee8685dc89ed}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!opencl\+\_\+use\+\_\+buflist@{opencl\+\_\+use\+\_\+buflist}}
\index{opencl\+\_\+use\+\_\+buflist@{opencl\+\_\+use\+\_\+buflist}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{opencl\+\_\+use\+\_\+buflist}]{\setlength{\rightskip}{0pt plus 5cm}void opencl\+\_\+use\+\_\+buflist (
\begin{DoxyParamCaption}
\item[{{\bf psdata\+\_\+buf\+List}}]{bl}
\end{DoxyParamCaption}
)}\label{particle__system__host_8c_a264aaddb80e120e5ea4aee8685dc89ed}
Use specified buffer in computations

Sets the arguments of kernels using psdata to this buflist


\begin{DoxyParams}{Parameters}
{\em bl} & Buffer list to use \\
\hline
\end{DoxyParams}
\hypertarget{particle__system__host_8c_a2f9361e3844559923a7128b5c4770cc9}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!populate\+\_\+position\+\_\+cuboid\+\_\+device\+\_\+opencl@{populate\+\_\+position\+\_\+cuboid\+\_\+device\+\_\+opencl}}
\index{populate\+\_\+position\+\_\+cuboid\+\_\+device\+\_\+opencl@{populate\+\_\+position\+\_\+cuboid\+\_\+device\+\_\+opencl}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{populate\+\_\+position\+\_\+cuboid\+\_\+device\+\_\+opencl}]{\setlength{\rightskip}{0pt plus 5cm}void populate\+\_\+position\+\_\+cuboid\+\_\+device\+\_\+opencl (
\begin{DoxyParamCaption}
\item[{double}]{x1, }
\item[{double}]{y1, }
\item[{double}]{z1, }
\item[{double}]{x2, }
\item[{double}]{y2, }
\item[{double}]{z2, }
\item[{unsigned int}]{xsize, }
\item[{unsigned int}]{ysize, }
\item[{unsigned int}]{zsize}
\end{DoxyParamCaption}
)}\label{particle__system__host_8c_a2f9361e3844559923a7128b5c4770cc9}
\hypertarget{particle__system__host_8c_a543f95a759ce9b341f399c0c7e52b909}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!sync\+\_\+psdata\+\_\+device\+\_\+to\+\_\+host@{sync\+\_\+psdata\+\_\+device\+\_\+to\+\_\+host}}
\index{sync\+\_\+psdata\+\_\+device\+\_\+to\+\_\+host@{sync\+\_\+psdata\+\_\+device\+\_\+to\+\_\+host}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{sync\+\_\+psdata\+\_\+device\+\_\+to\+\_\+host}]{\setlength{\rightskip}{0pt plus 5cm}void sync\+\_\+psdata\+\_\+device\+\_\+to\+\_\+host (
\begin{DoxyParamCaption}
\item[{{\bf psdata}}]{data, }
\item[{{\bf psdata\+\_\+buf\+List}}]{bl}
\end{DoxyParamCaption}
)}\label{particle__system__host_8c_a543f95a759ce9b341f399c0c7e52b909}
Copy buffer data from host to device


\begin{DoxyParams}{Parameters}
{\em data} & Host buffer \\
\hline
{\em bl} & \hyperlink{structDevice}{Device} buffer list \\
\hline
\end{DoxyParams}
\hypertarget{particle__system__host_8c_a017aa0e283c0bb6ee128ff69cf10dd81}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!sync\+\_\+psdata\+\_\+host\+\_\+to\+\_\+device@{sync\+\_\+psdata\+\_\+host\+\_\+to\+\_\+device}}
\index{sync\+\_\+psdata\+\_\+host\+\_\+to\+\_\+device@{sync\+\_\+psdata\+\_\+host\+\_\+to\+\_\+device}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{sync\+\_\+psdata\+\_\+host\+\_\+to\+\_\+device}]{\setlength{\rightskip}{0pt plus 5cm}void sync\+\_\+psdata\+\_\+host\+\_\+to\+\_\+device (
\begin{DoxyParamCaption}
\item[{{\bf psdata}}]{data, }
\item[{{\bf psdata\+\_\+buf\+List}}]{bl}
\end{DoxyParamCaption}
)}\label{particle__system__host_8c_a017aa0e283c0bb6ee128ff69cf10dd81}
Copy buffer data from device to host


\begin{DoxyParams}{Parameters}
{\em data} & Host buffer \\
\hline
{\em bl} & \hyperlink{structDevice}{Device} buffer list \\
\hline
\end{DoxyParams}
\hypertarget{particle__system__host_8c_ae70d2a7474666f266b0ea73b278989bf}{}\index{particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}!terminate\+\_\+ps\+\_\+opencl@{terminate\+\_\+ps\+\_\+opencl}}
\index{terminate\+\_\+ps\+\_\+opencl@{terminate\+\_\+ps\+\_\+opencl}!particle\+\_\+system\+\_\+host.\+c@{particle\+\_\+system\+\_\+host.\+c}}
\subsubsection[{terminate\+\_\+ps\+\_\+opencl}]{\setlength{\rightskip}{0pt plus 5cm}void terminate\+\_\+ps\+\_\+opencl (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\label{particle__system__host_8c_ae70d2a7474666f266b0ea73b278989bf}
Terminate Open\+C\+L

Releases kernels, command queues and context. Does not release any buffers, though they may be invalid without the context. 